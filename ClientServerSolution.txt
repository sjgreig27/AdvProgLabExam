import java.net.*;
import java.io.*;

public class CalculatorClient{
	private static String SERVER = "127.0.0.1";
	private static Integer PORT = 8765;
	private static String[] commands;

	public static void main (String[] args) throws IOException{
		
		//Define client statements
		commands = new String[]{"CALCULATE: 2,3,+", "CALCULATE: 5,1,-", "CALCULATE: 3,2,/", "", "EXIT:"};
		
		Socket socket = new Socket(SERVER, PORT);
		PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
		BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));
		int index =0;
		while(true){
			String message = commands[index];
			System.out.println (message);
			out.println(message);
			message = in.readLine();
			if (message==null){
				break;
			}
			System.out.println(message);
			out.println("RECEIVED");
			index++;
		}
		out.close();
		in.close();
		socket.close();
	}
}








import java.net.*;
import java.io.*;

public class CalculatorServer{
	private static int PORT = 8765;
	public static void main (String[] args) throws IOException{

		ServerSocket serverSocket = new ServerSocket(PORT);
		Socket client = serverSocket.accept();
		PrintWriter out=null;
		BufferedReader in=null;

		try{
			out = new PrintWriter(client.getOutputStream(), true);
			in = new BufferedReader(new InputStreamReader(client.getInputStream()));
			String response = "";
			while(true){
				String message = in.readLine();
				if(message == null) {
					break;
				}
				else if(message.startsWith("CALCULATE:")) {
					String [] input = message.trim().split("[:]");
					String[] calculation = input[1].trim().split("[,]");
					try{
						int operand1 = Integer.parseInt(calculation[0]);
						int operand2 = Integer.parseInt(calculation[1]);
						int result = 0;
						if (calculation[2].equals("+")){
							result=operand1+operand2;
							response = "ANSWER: "+result;
						}
						else if (calculation[2].equals("-")){
							result=operand1-operand2;
							response = "ANSWER: "+result;
						}
						else{
							response = "OPERATION NOT SUPPORTED";
						}
					}	
					catch(NumberFormatException x){
						response = "FORMAT OF CALCULATION INCORRECT"; 
					}
				}
				else if (message.startsWith("EXIT")){
					break;
				}
				else {
					response = "SORRY, UNKNOWN COMMAND";
				}
				// send the response
				out.println(response);
				// Wait for a response. If none comes, the client is dead
				if(in.readLine() == null) {
					break;
				}
			}
		}
		catch (Exception e){}
		finally{
			if(in!=null)
				in.close();
			if(out!=null)
				out.close();
			if(serverSocket!=null)
				serverSocket.close();
		}
	}
}
